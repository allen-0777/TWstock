<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>異常診斷儀表板</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bq.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    {% include 'navbar.html' %}
    <div id="wrapper">
        <div id="content-wrapper" class="d-flex flex-column">
            <div id="content">
                <div class="container-fluid">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3"
                            style="padding-bottom: 0 !important; margin-bottom: 0 !important;">
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="KK-NewTaipei" href="/dashboard/KK-NewTaipei/{{filter_date}}"
                                        role="tab" aria-controls="newtaipei" aria-selected="true" style="color: gray;">新北國光</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="KK-Chiayi" href="/dashboard/KK-Chiayi/{{filter_date}}" role="tab"
                                        aria-controls="Chiayi" aria-selected="false" style="color: gray;">嘉義國光</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="shinbus" href="/dashboard/shinbus/{{filter_date}}" role="tab"
                                        aria-controls="shinbus" aria-selected="false" style="color: gray;">欣欣</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="CHbus" href="/dashboard/CHbus/{{filter_date}}" role="tab"
                                        aria-controls="chbus" aria-selected="false" style="color: gray;">彰客</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="ibus" href="/dashboard/ibus/{{filter_date}}" role="tab" aria-controls="ibus"
                                        aria-selected="false" style="color: gray;">漢程</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="ibus" href="/dashboard/TAICHUNG/{{filter_date}}" role="tab" aria-controls="ibus"
                                        aria-selected="false" style="color: gray;">台中</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="ibus" href="/dashboard/Capitalbus/{{filter_date}}" role="tab" aria-controls="ibus"
                                        aria-selected="false" style="color: gray;">首都</a>
                                </li>
                                <ul class="nav" style="margin-left: auto;">
                                    <li class="nav-item">
                                        <input id="datafilter" type="date" onchange="handleDateChange(this)" value="{{ filter_date }}">
                                    </li>
                                </ul>
                                <ul class="nav">
                                    <select id="filterSelect" , onchange="SelectPlate(this)">
                                        <option> 車牌 </option>
                                        {% for plate in platelist %}
                                        <option value={{plate}}>{{plate}}</option>
                                        {% endfor %}
                                    </select>
                                </ul>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="datatable" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th>發生時間</th>
                                            <th>最後時間</th>
                                            <!-- <th>Company</th> -->
                                            <!-- <th>SrvArea</th> -->
                                            <th>車型</th>
                                            <th>車牌號碼</th>
                                            <th>異常碼</th>
                                            <th>發生次數</th>
                                            <th>異常問題描述</th>
                                            <!-- <th>異常描述</th> -->
                                            <th>異常狀態</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- {{table | safe}} -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>

    <script>
        // $(document).ready(function () {
        //     $('a.btn.btn-primary').on('click', function (event) {
        //         event.preventDefault();  // 阻止<a>标签的默认行为
        //         var text = $(this).text();  // 获取链接的文本
        //         $('#modal-content').text(text);  // 将模态框的内容设置为链接的文本
        //         $('#myModal').modal('show');  // 显示模态框
        //     });
        // });
        $(document).ready(function () {
            // 移除所有tab的active狀態
            $('.nav-tabs a').removeClass('active');

            // 獲取當前URL的最後一部分（也就是tab名稱）
            var tabName = window.location.pathname.split('/').pop();

            // 根據tab名稱來設置對應tab的active狀態
            $('.nav-tabs a[href="/dashboard/' + tabName + '"]').addClass('active');

            $('.nav-tabs a').on('click', function (event) {
                // event.preventDefault();  // 阻止<a>標籤的默認行為
                $('.nav-tabs a').removeClass('active');
                $(this).addClass('active');
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            var data = {{ table | tojson | safe
        }};
        console.log(data);
        // var data = {{ table | safe}};
        $('#datatable').DataTable({
            data: data,
            columns: [
                { data: '發生時間' },
                { data: '最後時間' },
                // {data: '公司' },
                // {data: '區域' },
                { data: '車型' },
                { data: '車牌號碼' },
                { data: '異常碼' },
                { data: '發生次數' },
                // {data: '異常訊息' },
                { data: '異常問題描述' },
                {
                    data: '異常狀態',
                    // render: function (data, type, row) {
                    //     console.log(data);  
                    //     if (data == "異常") {
                    //         return '<i class="fa fa-exclamation-triangle fun-bigger text-warning"></i>';
                    //     }
                    //     return data;
                    // }
                }
            ],
            pageLength: 25
        });
        });
        function handleDateChange(input) {
            const date = input.value;
            const tabName = "{{ tab_name }}";
            window.location.href = `/dashboard/${tabName}/${date}`;
            
        }
        function SelectPlate(input) {
            const plate = input.value;
            // const table = {{ table | tojson | safe }};
            if (plate === "車牌") {
                $('.dataTables_filter input').val("").keyup();
                console.log(filterValue)
            } else {
                $('.dataTables_filter input').val(plate).keyup();
            }
        };
        window.addEventListener('popstate', function (event) {
            console.log('User navigated back');
        });
    </script>
    <script>
        $(document).ready(function () {
            const date = "{{ filter_date }}";
            const tabName = "{{ tab_name }}";
            // 移除所有tab的active狀態
            $('.nav-tabs a').removeClass('active').css("background-color", "");
            // 根據tab名稱來設置對應tab的active狀態
            $('.nav-tabs a[href="/dashboard/' + tabName + '/' + date + '"]').addClass('active').css("color", "green");
            $('.nav-tabs a').on('click', function (event) {
                // event.preventDefault();  // 阻止<a>標籤的默認行為
                $('.nav-tabs a').removeClass('active');
                $(this).addClass('active');
            });
        });
    </script>
</body>

</html>